<html>
<head>
  <script src = "https://ajax.aspnetcdn.com/ajax/knockout/knockout-3.1.0.js"
           type = "text/javascript"></script>

  <style type="text/css">
    html, body { height: 100%; margin: 0; padding: 0; }
    #map { height: 100%; }
  </style>
</head>
<body>
  
  <div>
  <table>
      <thead>
          <tr><th>My Locations</th>
      </thead>
      <tbody data-bind="foreach: items">
          <tr>
              <td data-bind="text: $data.name"></td>
          </tr>
      </tbody>
  </table>
  </div>
  <br>
    <div id="map"></div>
  <script type="text/javascript">
  function initMap() {
  var locations = [
      { name: "torre de tv", ltd: -15.80, lng: -47.93},
      { name: "shopping", ltd: -15.801, lng: -47.93},
      { name: "parque da cidade", ltd: -15.80, lng: -47.93},
      { name: "congresso", ltd: -15.802, lng: -47.93},
      { name: "catedral", ltd: -15.803, lng: -47.93}
    ];
  var LocalView = function(items) {
      this.items = ko.observableArray(items);
  };
  ko.applyBindings(new LocalView(locations));

  //var locationArray = ko.observableArray(locations);

  var myLatLng = {lat: -15.7797200, lng: -47.9297200};

  var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 13,
    center: myLatLng
  });

  locations.forEach(function (location){
    var $body = $('body');
    var $wikiElem = $('#wikipedia-links');
    var contentString = '<div id="content">'+
      '<div class="wikipedia-container">'+
      '<h3 id="wikipedia-header">Relevant Wikipedia Links</h3>'+
      '<ul id="wikipedia-links">List</ul>'+
      '</div>';

  //  var infowindow = new google.maps.InfoWindow({
  //    content: contentString
  //  });



    // clear out old data before new request
    $wikiElem.text("");

    var wiki_url = 'http://en.wikipedia.org/w/api.php?action=opensearch&search='+ location.name +'&format=json&callback=wikiCallback';
    var wikirequesttimeout = setTimeout(function(){
      $wikiElem.text("Failed to get wikipedia resourses");
    }, 8000);

    $.ajax({
      url: wiki_url,
      dataType: "jsonp",
      success: function(response){
        var articleList = response[1];
        for (var i =0; i < articleList.length; i++){
          articleStr = articleList[i];
          var url = 'http://en.wikipedia.org/wiki/'+ articleStr;
          $wikiElem.append('<li><a href="'+ url +'">'+ articleStr +'</a></li>');

          infowindow.setContent(
            '<div>'+
            '<h3>Relevant Wikipedia Links</h3>'+
            '<li><a href="'+ url +'">'+ articleStr +'</a></li>'+
            '</div>');

        };
        clearTimeout(wikirequesttimeout);
      }
    });


    var marker = new google.maps.Marker({
      position: new google.maps.LatLng(location.ltd,location.lng),
      map: map,
      title: location.name
    });
    marker.addListener('click', function() {
        infowindow.open(map, marker);
      });
      var infowindow = new google.maps.InfoWindow({
        content: contentString
      });
  });

}

</script>



  <!--TODO: Load the JS API ASYNCHRONOUSLY below.-->
  <script async defer
   src="https://maps.googleapis.com/maps/api/js?v=3&key=AIzaSyBQRsSHTd1eqJ6WqOlHyO3KA90BxwwnyV4&callback=initMap">
  </script>
  <script src="js/libs/jquery.min.js"></script>
</body>
</html>
